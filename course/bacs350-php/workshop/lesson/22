BACS 350 - Lesson22

* Controller Design
* Friday, Oct 12, 2018
* by Mark Seaman

![](img/Bear_Logo.png)



### Review
* Object Oriented Data Types
* Building Apps
* Pair Programming


### Next Steps
* Controller Design Pattern


## Controller

### Limitation of current solution
* Add records requires post to different page
* After record we must redirect back to main page

### insert.php

```
    // Add new record
    $name = 'Test User';
    $email = 'tester@gmail.com';

    // Add database row
    $query = "INSERT INTO subscribers (name, email) VALUES (:name, :email);";
    $statement = $db->prepare($query);
    $statement->bindValue(':name', $name);
    $statement->bindValue(':email', $email);
    $statement->execute();
    $statement->closeCursor();
```
### insert.php
Return to starting page on success

```
if ($success) {
   header('Location: index.php');
}
```

### Add Form
Post to insert.php page

```
echo '<form action="insert.php" method="post">
           <p><label>Name:</label> &nbsp; <input type="text" name="name"></p>
           <p><label>Email:</label> &nbsp; <input type="text" name="email"></p>
           <p><input type="submit" value="Sign Up"/></p>
       </form>';
```

### Use Main Page to Add
Pass a hidden field in Form post (action)

```
echo '<form action="index.php" method="post">
           <p><label>Name:</label> &nbsp; <input type="text" name="name"></p>
           <p><label>Email:</label> &nbsp; <input type="text" name="email"></p>
           <p><input type="submit" value="Sign Up"/></p>
           <input type="hidden" name="action" value="add">
       </form>';
```

### Add in the Main Page
When action of "add" then add a record

```
$action = filter_input(INPUT_POST, 'action');
if ($action == 'add') {
    $name  = filter_input(INPUT_POST, 'name');
    $email = filter_input(INPUT_POST, 'email');
    $this->add($name, $email);
}
```


### Object Handler
Move action handler to object

```
class Subscribers {

    function handle_add() {
        $action = filter_input(INPUT_POST, 'action');
        if ($action == 'add') {
            $name  = filter_input(INPUT_POST, 'name');
            $email = filter_input(INPUT_POST, 'email');
            $this->add($name, $email);
        }
    }
}
```

### Controller for Subscribers View
Simple sequence for listing and adding records

```
$subscribers->handle_add();
$subscribers->show_subscribers();
$subscribers->add_form();
```


### Sample Code
* [Subscriber List Template](http://unco-bacs.org/bacs_350/templates/subscriber.php)
* [Solution 22](http://unco-bacs.org/bacs_350/solution/22)
* Pull changes from Mark-Seaman/BACS_350_2018_Fall


### Project 22
* Project
    * Copy code from project 19
    * One click testing for Local and Remote
    * Code commits for "Project, Data, Views, Test"
* Data
    * SQL table code "notes.sql"
    * General DB connection
    * Books CRUD functions in 'note_crud.php'
    * Book data object in 'notes.php'
* Views
    * View to show add form in 'note_view.php'
    * View to show list of notes in 'note_view.php'
    * Button adds to list
    * Redirect back to 'index.php'
* Test
    * Valid HTML from index.php
    * Log each page load
    * Link on index page to show page history

